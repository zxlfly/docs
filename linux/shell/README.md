# shell
- Linux系统可分为四个部分
  - 应用软件
    - 常见的web应用，数据库应用
  - 窗口管理软件
    - 图形化桌面环境
  - GNU系统工具链（shell属于这）
    - 处理文件
    - 操作文本
    - 管理进程
  - Linux内核
    - 系统内存管理
    - 软件进程管理
    - 硬件设备管理
    - 文件系统管理

## 如何使用shell
- Linux shell是一特殊的交互式工具，它提供了文件文件管理，运行进程的途径
- shell的核心是命令提示符，允许用户输入命令，然后解释命令，并在内核中执行
- 用户可以编写脚本文件，将多个shell命令以某种形式组织起来，作为程序一起执行

## 常见的shell
- **bsh：**一种最早出现在Unix系统上的标准shell，全称Bourne shell
- **bash：**一种对bsh在功能上进行扩展的shell，几乎可以涵盖shell所需的所有功能
- **ksh：**一种与bsh兼容的编程shell，增加了很多特性，常见于Unix操作系统
- **tcsh：**一种具有C语言风格语法结构的shell，常见于嵌入式开发（IC公司）
- **zsh：**一种结合和bash、ksh和tsh的特点，同时提供了高级编程特性的高级shell
- **sh：**在绝大部分Linux发行版中，作为软连接指向其他shell（默认bash）

## Shell常用命令

### 管理文件和目录
**1.管理文件和目录**
- ``cd``:可以用于切换当前的工作目录
- ``pwd``:可以打印当前工作目录的名称，注意在linux中打印这个词一般不是指打印机的打印，而是表示将文本内容输入到屏幕上。
- ``ls``:列出当前目录下的所有文件
- ``touch``:用于更改文件的修改区间，也可以用于创建一个空文件
- ``cp``:复制文件或目录
- ``mv``:移动或重命名一个文件或目录
- ``rm``:用于删除一个文件或目录
- ``mkdir``:用于创建一个目录
- ``rmdir``:用于删除一个目录，一般是用于删除空目录
- ``file``:用于判断一个文件的文件类型
- ``cat``：可以打印文件的文本内容
- ``more``：用于打开一个文件，进行交互式的阅读课，仅允许向下滚动less：类似more，区别在于使用less可以上下浏览文件，并在查看文件内容前不会加载到所有数据，更适合对大文件的浏览
- ``tail``：打印文件的最后部分，默认为最后十行
- ``head``：打印文件的开头部分默认为前十行
**2.管理系统进程**
- ``ps``：显示系统目前运行的进程信息
- ``topz``:显示系统目前运行进程的动态实时信息，与ps的区别是ps是静态的，而top命令可以进行动态的刷新
- ``Kill``:可以向进程发送一个信号通常用于终止一个进程
- ``killall``:可以通过进程的名称向进程的所有实力发送终止信号
**3.管理磁盘空间**
- ``mount``：提供文件系统的挂载功能，默认可以显示当前挂载的所有文件系统
- ``umount``：取消文件系统与其挂载点的连接，使其不能再被访问到，简单来说就是卸载某一个挂载点
- ``df``:用于查看当前文件系统的磁盘空间使用情况
- ``du``:用于计算指定文件或目录占用磁盘空间的大小
**4.处理数据文件**
- ``sort``:可以对文本文件进行排序
- ``grep``:能够查找文件里符合条件的字符串，支持正则表达式和简单模式匹配
- ``gzip``:提供了对zip压缩格式的文件压缩和解压-  
- ``tar``:可以对文件进行归档，压缩和解压缩

### Shell外部命令
- 1.外部命令(文件系统命令) , 通常位于/bin、/sbin. /usr/bin. /usr/sbin 等目录
- 2. fork :外部命令执行时,会创建出一个子进程。( 以ps命令为例)

### Shell内建命令
- 1.作为shell工具的组成部分,内建命令不需要使用子进程来执行。
- 2.对于有些命令,有多种实现,既有外部命令,也有内建命令。
- 3.了解某个命令的类型
  - ``type -a``
- 4.了解所有的内建命令
  - ``man builtin``

## Shell脚本基础
### 脚本创建、执行与退出状态码
- 1.创建shell脚本
- 2.执行脚本
  - ``chmod``增加脚本的可执行权限
  - 使用绝对或相对路径执行shell 脚本
- 3.脚本的退出状态码
  - ``$?``查看（0为成功）
    - 默认以脚本最后一行命令的状态码为退出状态码
  - ``exit``命令可以改变输出

### 变量的定义与使用
- 全局环境变量
  - ``set``查看，通常大写
- 局部环境变量
  - ``set``查看，通常小写
- 自定义用户变量
  - 由字母、数字、下划线组成
  - 长度不超过20个字符
  - 区分大小写
- 变量的定义/赋值
  - ``=``
  - 等号两边不能有空格
- 使用``$``对变量进行引用
  - 建议使用``${variable_ name}``
- 命令替换:将命令的输出赋值给变量
  - 反引号、command
  - ``$(command)``

### 输出文本
- ``echo``命令
- ``echo $USER * $(date)``
  - 会解释所有特殊字符，会忽略反斜杠这样的特殊转译字符
- ``echo ' $USER * $(date)'``
  - 直接当成普通字符出输出
- ``echo "$USER * $(date)"``
  - 会忽略通配符

### 数学运算
- expr命令
  - 可以处理整数的加减乘除
  - 注意有的需要转译
  - ``expr 2 \* 4`` 
- $[ operation ]
  - 可以处理整数的加减乘除
  - ``echo $[ 2 * ( 9 - 7 ) ]``
- bc命令(支持浮点数运算)

## Shell脚本条件控制
### if-then语句
- if-then语句格式
```
if command
then 
    commands
fi

if command; then 
    commands
fi
```
- 当if后面的命令,运行后的退出状态码是0时，then后面的命令会被执行。
- ``else``,``elif``
```
if command
then
  commands
elif commands
then 
  commands
else 
  commands
fi
```
### 条件测试
#### 数值
- ``n1 -eq n2``
  - n1是否等于n2
- ``n1 -ge n2``
  - n1是否大于或等于n2
- ``n1 -gt n2``
  - n1是否大于n2
- ``n1 -le n2``
  - n1是否小于或等于n2
- ``n1 -lt n2``
  - n1是否小于n2
- ``n1 -ne n2``
  - n1是否不等于n2

#### 字符串
- ``str1 = str2``
  - 当两个串有相同内容、长度时为真
- ``str1 != str2``
  - 当串str1和str2不等时为真
- ``-n str1`` 
  - 当串的长度大于0时为真(串非空)
- ``-z str1`` 
  - 当串的长度为0时为真(空串)
- ``str1``   
  - 当串str1为非空时为真
- ``str1 > str2``
  - 比较的ASCII码
- ``str1 < str2``
  - 比较的ASCII码

#### 文件
- ``-O file``
  - 存在且属于当前用户
- ``-G file``
  - 存在且默认组属于当前用户
- ``file1 -nt file2``
  - 1是否比2新
- ``file1 -ot file2``
  - 1是否比2旧
- ``-e file``
  - file是否存在
- ``-r file``
  - 存在并且可读
- ``-w file``
  - 存在并且可写
- ``-x file``
  - 存在且可执行
- ``-f file``
  - 存在且是一个文件
- ``-d file``
  - 存在且是一个目录
- ``-s file``
  - 存在且非空
- ``-c file``
  - 文件为字符特殊文件为真
- ``-b file``
  - 文件为块特殊文件为真
- ``-t file``
  - 当文件描述符(默认为1)指定的设备为终端时为真

#### 复合条件测试
使用布尔运算符
- ``[ condition1 ] && [ condition2 ]``
- ``[ condition1 ] | | [ condition2 ]``

### if-then语句高级特性
#### 双括号
- 支持高级数学表达式的计算
- 命令格式: (( expression ))
- expression可以是数学赋值或比较表达式
- 普通脚本中也可以使用
```
if (( ${val} ** 2 > 90 ))
then 
  (( ans = ${val} ** 2 ))
  echo "the square of ${val} is ${ans}"
fi
```
#### 双方括号
- 支持针对字符串比较的高级特性
- 命令格式: [[ expression ]]
- 除了标准的字符串比较，还支持模式匹配
```
if [[ ${USER} == r* ]]
then
  echo "hello ${USER}"
fi
```

### for循环
- 读取列表中的值
- 读取列表中的复杂值
- 从变量读取列表
- 从命令读取值
- 更改字段分隔符$IFS
- 用通配符遍历目录
```
for value in 1 2 3 4 5
do
echo "The value is $value"
done
// 输出
// The value is 1
// The value is 2
// The value is 3
// The value is 4
// The value is 5
```

### while循环
```
c=0;
while [ $c -lt 3 ]
do
echo "Value c is $c"
c=`expr $c + 1`
done
```

### until循环
until 循环执行一系列命令直至条件为 true 时停止。until 循环与 while 循环在处理方式上刚好相反。
```
c=0;
until [ $c -eq 3 ]
do
echo "Value c is $c"
c=`expr $c + 1`
done
```

### 跳出循环
#### break
break命令允许跳出所有循环（终止执行后面的所有循环）。
```
i=0
while [ $i -lt 5 ]
do
i=`expr $i + 1`
if [ $i == 3 ]
then
break
fi
echo -e $i
done

//1
//2
```
#### break n
表示跳出第 n 层循环。

#### continue
continue命令与break命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环。
```
i=0
while [ $i -lt 5 ]
do
i=`expr $i + 1`
if [ $i == 3 ]
then
continue
fi
echo -e $i
done
```
#### continue n
可指定跳过的循环层数continue n

#### case语句
```
grade="B"
case $grade in
"A") echo "Very Good!";;
"B") echo "Good!";;
"C") echo "Come On!";;
*) 
echo "You Must Try!"
echo "Sorry!";;
esac
```
取值后面必须为关键字 in，每一模式必须以右括号结束。如果无一匹配模式，使用星号 * 捕获该值，再执行后面的命令。

## 脚本参数
### 命令行参数
- 1.命令行参数:向shell脚本传递数据最基本的方法
- 2.位置参数: $0是脚本名，$1到$9表示第一到第九个参数，第十个参数可以用${10}表示
- 3.若参数内容包含空格，则必须使用引号

### 特殊参数变量
- $#存储了脚本运行时携带的命令行参数的个数

### 移动变量
- 1.shift命令可以将每个参数变量向左移动一个位置
  - $0的值是不会变的，$1会被删除且不能恢复
- 2.常用于遍历命令行参数
- 3.shift n

### 交互式处理
- 1.从标准输入读取数据并赋值给指定变量
  - 指定输出的命令行提示信息(-p)
  - 指定接收单字符的数据(-n)
  - 设置输入的超时时间(-t)
- 2.从文件中读取参数
  - ``read``

## 脚本重定向
### 标准文件描述符
Linux用标准文件描述符来标识每个文件对象
- 文件描述符``0``，缩写``SEDIN``，描述：标准输入
- 文件描述符``1``，缩写``STDOUT``，描述：标准输出
- 文件描述符``2``，缩写``STDERR``，描述：标准错误

### 重定向错误输出
- 1.只重定向错误输出
  - ``ls -al badfile 2> error. log``
- 2.重定向错误和普通输出
  - ``ls -al badfile testfile 2> error.log 1>output. log``
- 3.重定向错误和普通输出到同一个文件
  - ``ls-al badfile testfile &> output. Log``

### 在脚本中重定向输出
- 1.临时重定向
  - 重定向到文件描述符时，必须在文件描述符数字前加一个 &
  - ``echo "This is a error message" >&2``
- 2.永久重定向
  - 使用exec命令在脚本执行期间重定向某个特定文件描述符
  - exec命令会启动一个shell来进行数据重定向

### 创建自己的重定向
最多有9个打开的文件描述符，除了上面默认的3个还有3-8这6个
#### 创建文件描述符
- ``exec 3>ouput_ file``
- ``exec 0<input_ file``
- ``exec 6<>test_ file``
#### 关闭文件描述符
- ``exec 6>&-``
- ``exec 6<&-``


## 脚本函数
### 基本的脚本函数
需要先定义再使用
- 1.创建函数
```
function func_ _name {...}
func_ _name( .{..}
```
- 2.使用函数
``func_ name``

### 在函数中使用变量
- 1.向函数传递参数
  - 位置参数变量
    - $0函数名，$1、$2....
    - $*表示参数列表
    - $#表示传入参数个数
- 2.在函数中处理变量
  - 全局变量
    - shell脚本主体定义的全局变量，函数中也是可以访问的
  - 局部变量local

### 函数的返回值
- 默认的退出状态码
  - 最后一条命令返回的退出状态码
  - $?获取
- 使用``return``命令自定义退出码
  - 整数0-255
- 使用命令执行获取函数输出
  - ``ans= $(func)``
  - ``echo``